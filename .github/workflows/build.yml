name: Build

on:
  push:
    branches:
      - main
    pull_request:

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Install dependencies
        run: npm install

      - name: Build
        run: npx nx build inventory --configuration=production --verbose
        env:
          BASE_URL: "/inventory/"

  translate:
    runs-on: ubuntu-latest
    needs: build

    steps:
          - name: 📥 Clonar repositorio
            uses: actions/checkout@v3

          - name: 🏗️ Configurar Node.js
            uses: actions/setup-node@v3
            with:
              node-version: 18

          - name: 📦 Instalar dependencias
            run: npm install axios

          - name: 🌎 Generar traducciones en todas las apps
            run: node /apps/inventory/scripts/translate.js

          - name: 🚀 Commit de traducciones
            run: |
              git config --global user.name "GitHub Actions"
              git config --global user.email "actions@github.com"
              git add apps/**/locales/*.json
              git commit -m "🔄 Auto-generadas nuevas traducciones"
              git push    